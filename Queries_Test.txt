{\rtf1\ansi\ansicpg1252\cocoartf1561\cocoasubrtf600
{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\paperw11900\paperh16840\margl1440\margr1440\vieww10800\viewh8400\viewkind0
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f0\fs24 \cf0 \
\
\
\
SELECT \'911) What is the average price for a listing with 8 bedrooms?' FROM DUAL;\
\
SELECT AVG(CD.PRICE)\
FROM COSTS_DETAILS CD , LISTING L\
WHERE L.LISTING_ID = CD.LISTING_ID AND L.LISTING_ID IN (SELECT M.LISTING_ID\
\
                                                        FROM MATERIAL_DESCRIPTION M\
                                                        WHERE M.BEDROOMS = 8);\
                                                        \
                                                        \
                                                        \
------------------------------------------------------------------------------------------------------- \
                                                        \
                                                        \
SELECT '2) What is the average cleaning review score for listings with TV?' FROM DUAL;                                                        \
                                                        \
SELECT AVG(RS.REVIEW_SCORES_CLEANLINESS)                                                  --for some reason returns null\
FROM REVIEWS_SCORES RS, LISTING L                                                     \
WHERE RS.LISTING_ID = L.LISTING_ID AND L.LISTING_ID IN (SELECT LA.LISTING_ID\
                                                        FROM AMENITIES AM, LISTING_AMENITIES LA\
                                                        WHERE AM.AMENITY_ID = LA.AMENITY_ID AND AM.AMENITY_NAME = 'TV'\
                                                        );\
                                                        \
                                                        \
------------------------------------------------------------------------------------------------------- \
                                                                                                               \
SELECT '3) Print all the hosts who have an available property between date 03.2019 and 09.2019.' FROM DUAL;                                                    \
                                                        \
SELECT * \
FROM HOST H\
WHERE H.HOST_ID IN (SELECT L.HOST_ID\
                    FROM LISTING L, CALENDAR CA\
                    WHERE L.LISTING_ID = CA.LISTING_ID and CA.AVAILABLE = 't' and CA.CALENDAR_DATE >= TO_DATE('2019-03-01', 'YYYY-MM-DD') and CA.CALENDAR_DATE <= TO_DATE('2019-09-30', 'YYYY-MM-DD')      \
                    );\
 \
 \
 \
------------------------------------------------------------------------------------------------------- \
                   \
SELECT '4) Print how many listing items exist that are posted by two different hosts but the hosts have the same\
name.' FROM DUAL;\
                    \
SELECT COUNT(*)\
FROM LISTING L, HOST H\
WHERE L.HOST_ID = H.HOST_ID and H.HOST_ID IN (SELECT H1.HOST_ID\
                      FROM HOST H1, Host H2\
                      WHERE H1.HOST_NAME = H2.HOST_NAME and H1.HOST_ID != H2.HOST_ID\
                      );\
                                                        \
\
\
\
-------------------------------------------------------------------------------------------------------\
\
SELECT '5) Print all the dates that Viajes Eco has available accommodations for rent.' FROM DUAL;\
  \
SELECT CA.CALENDAR_DATE\
FROM CALENDAR CA, LISTING L\
WHERE CA.LISTING_ID = L.LISTING_ID and CA.AVAILABLE = 't' and L.LISTING_ID IN (SELECT L1.LISTING_ID\
                                                                              FROM LISTING L1, HOST H\
                                                                              WHERE L1.HOST_ID = H.HOST_ID and H.HOST_NAME = 'Viajes Eco'\
                                                                              );\
                                                                              \
                                                                              \
-------------------------------------------------------------------------------------------------------\
\
\
SELECT '6) Find all the hosts (host_ids, host_names) that have only one listing.' FROM DUAL;\
\
SELECT H.HOST_ID, H.HOST_NAME\
FROM HOST H \
WHERE H.HOST_ID IN (SELECT L.HOST_ID\
                    FROM LISTING L\
                    GROUP BY L.HOST_ID HAVING COUNT(*) = 1\
                   );\
                                                        \
-------------------------------------------------------------------------------------------------------\
      \
SELECT '7) What is the difference in the average price of listings with and without Wifi.' FROM DUAL;\
\
WITH with_wifi AS (SELECT LA.LISTING_ID\
                         FROM AMENITIES AM, LISTING_AMENITIES LA                                     \
                         WHERE AM.AMENITY_ID = LA.AMENITY_ID and AM.AMENITY_NAME = 'Wifi')\
                         \
         \
SELECT AVG(CD1.PRICE) - AVG(CD2.PRICE)\
FROM COSTS_DETAILS CD1, COSTS_DETAILS CD2, with_wifi WW\
WHERE CD1.LISTING_ID IN WW.LISTING_ID and CD2.LISTING_ID NOT IN WW.LISTING_ID;                 --seems like LA is empty\
\
\
-------------------------------------------------------------------------------------------------------\
                                                        \
                                                 \
SELECT '8) How much more (or less) costly to rent a room with 8 beds in Berlin compared to Madrid on average?' FROM DUAL;\
              \
WITH beds AS (SELECT MD.LISTING_ID\
                         FROM MATERIAL_DESCRIPTION MD                                    \
                         WHERE MD.BEDS = 8)   \
         \
SELECT AVG(CD1.PRICE) - AVG(CD2.PRICE)\
FROM COSTS_DETAILS CD1, COSTS_DETAILS CD2, beds B\
WHERE CD1.LISTING_ID IN B.LISTING_ID\
\
and CD1.LISTING_ID IN (SELECT L.LISTING_ID\
                      FROM LISTING L\
                      WHERE L.CITY = 'Berlin')\
                                                        \
and CD2.LISTING_ID NOT IN B.LISTING_ID                                              \
\
and CD2.LISTING_ID IN (SELECT L.LISTING_ID\
                      FROM LISTING L\
                      WHERE L.CITY = 'Madrid');     \
                      \
                      \
                      \
                      \
-------------------------------------------------------------------------------------------------------\
\
SELECT '9) Find the top-10 (in terms of the number of listings) hosts (host_ids, host_names) in Spain.' FROM DUAL;\
\
SELECT H.HOST_ID , H.HOST_NAME\
FROM LISTING L, HOST H                                          \
WHERE L.COUNTRY = 'Spain' and L.HOST_ID = H.HOST_ID\
GROUP BY L.HOST_ID, H.HOST_NAME, H.HOST_ID\
ORDER BY COUNT(*) DESC\
FETCH FIRST 10 ROWS ONLY;\
\
\
\
\
-------------------------------------------------------------------------------------------------------\
\
\
SELECT '10) Find the top-10 rated (review_score_rating) apartments (id,name) in Barcelona.' FROM DUAL;\
              \
SELECT L.LISTING_ID, L.LISTING_NAME                                     --for some reason returns null\
FROM LISTING L, REVIEWS_SCORES RS\
WHERE L.LISTING_ID IN (SELECT L1.LISTING_ID\
                      FROM LISTING L1, MATERIAL_DESCRIPTION MD\
                      WHERE L.CITY = 'Barcelona' and MD.LISTING_ID = L.LISTING_ID and MD.PROPERTY_TYPE = 'appartment')\
ORDER BY RS.REVIEW_SCORES_RATING DESC\
FETCH FIRST 10 ROWS ONLY;\
                                                        \
\
\
\
\
\
}